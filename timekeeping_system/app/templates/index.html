<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="h-screen flex overflow-hidden">
    <a href="/auth/logout" class="fixed top-4 left-4 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg shadow">Logout</a>
    <!-- Main content takes up 60% width -->
    <div class="w-[60%] h-full bg-gray-100 flex items-center justify-center">
      <div
        class="bg-white p-10 rounded-2xl shadow-2xl w-full max-w-3xl text-center"
      >
        <h1 class="text-3xl font-bold text-blue-800 mb-6">
          ‚è∞ Timekeeping System
        </h1>

        <div class="flex justify-center mb-6">
          <svg
            viewBox="0 0 200 200"
            class="w-64 h-64"
            xmlns="http://www.w3.org/2000/svg"
          >
            <!-- Central Element -->
            <circle cx="100" cy="100" r="40" fill="#e0f7fa" />
            <circle cx="100" cy="100" r="35" fill="#b2ebf2" />

            <!-- Clock hands -->
            <line
              x1="100"
              y1="100"
              x2="100"
              y2="75"
              stroke="#0077b6"
              stroke-width="2"
              stroke-linecap="round"
              class="clock-hand"
              style="animation-duration: 12s"
            />
            <line
              x1="100"
              y1="100"
              x2="120"
              y2="100"
              stroke="#0077b6"
              stroke-width="2"
              stroke-linecap="round"
              class="clock-hand"
            />

            <!-- Icons around -->
            <!-- User -->
            <g class="icon-group" transform="translate(30, 30)">
              <circle cx="0" cy="0" r="15" fill="#ffcdd2" />
              <circle cx="0" cy="-3" r="5" fill="#fff" />
              <path
                d="M -8 8 Q 0 0 8 8"
                fill="none"
                stroke="#fff"
                stroke-width="2"
              />
            </g>

            <!-- Calendar -->
            <g class="icon-group" transform="translate(140, 30)">
              <rect
                x="-12"
                y="-12"
                width="24"
                height="24"
                rx="4"
                fill="#c8e6c9"
              />
              <rect x="-12" y="-6" width="24" height="2" fill="#fff" />
              <circle cx="-6" cy="3" r="1.5" fill="#fff" />
              <circle cx="0" cy="3" r="1.5" fill="#fff" />
              <circle cx="6" cy="3" r="1.5" fill="#fff" />
            </g>

            <!-- Chart -->
            <g class="icon-group" transform="translate(30, 140)">
              <rect
                x="-12"
                y="-12"
                width="24"
                height="24"
                rx="4"
                fill="#b3e5fc"
              />
              <line
                x1="-8"
                y1="8"
                x2="-8"
                y2="-5"
                stroke="#fff"
                stroke-width="2"
                stroke-linecap="round"
              />
              <line
                x1="0"
                y1="8"
                x2="0"
                y2="0"
                stroke="#fff"
                stroke-width="2"
                stroke-linecap="round"
              />
              <line
                x1="8"
                y1="8"
                x2="8"
                y2="-8"
                stroke="#fff"
                stroke-width="2"
                stroke-linecap="round"
              />
            </g>

            <!-- Check-in -->
            <g class="icon-group" transform="translate(140, 140)">
              <path
                d="M 0 -12 C -8 -12 -12 -8 -12 0 C -12 8 0 12 0 12 S 12 8 12 0 C 12 -8 8 -12 0 -12 Z"
                fill="#d1c4e9"
              />
              <circle cx="0" cy="-2" r="4" fill="#fff" />
            </g>
          </svg>
        </div>

        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a
            href="/employees"
            class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-full transition duration-300"
            >üë§ Manage Employees</a>
          
          <a
            href="/employees/add"
            class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-full transition duration-300"
            >‚ûï Add Employee</a>
          
          <a
            href="/timekeeping"
            class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-full transition duration-300"
            >üïí Manage Timekeeping</a>
          
          <a
            href="/timekeeping/add"
            class="bg-orange-600 hover:bg-orange-700 text-white px-6 py-2 rounded-full transition duration-300"
            >‚è∞ Add Timekeeping</a>
        </div>
      </div>
    </div>

    <!-- Chat box takes up 40% width -->
    <div class="w-[40%] h-full bg-white flex flex-col border-l border-gray-200">
      <!-- Message display area -->
      <div id="chat-container" class="flex-1 p-4 overflow-y-auto">
        <!-- Messages will be dynamically added here -->
      </div>

      <!-- Message input area -->
      <div class="p-4 border-t border-gray-200">
        <div class="flex items-center space-x-2">
          <input
            id="chat-input"
            type="text"
            class="flex-1 p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Enter your message..."
          />
          <button
            id="send-button"
            class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600"
          >
            Send
          </button>
        </div>
      </div>
    </div>

    <script>
      // Get DOM elements
      const chatContainer = document.getElementById("chat-container");
      const chatInput = document.getElementById("chat-input");
      const sendButton = document.getElementById("send-button");

      // Add user message (right aligned)
      function addUserMessage(message) {
        const messageDiv = document.createElement("div");
        messageDiv.className = "flex justify-end mb-2";
        messageDiv.innerHTML = `
                <div class="bg-blue-500 text-white p-3 rounded-lg max-w-[80%]">
                    ${message}
                </div>
            `;
        chatContainer.appendChild(messageDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;
      }

      // Add agent message (left aligned)
      function addAgentMessage(message) {
        const messageDiv = document.createElement("div");
        messageDiv.className = "flex justify-start mb-2";
        messageDiv.innerHTML = `
                <div class="bg-gray-200 text-gray-800 p-3 rounded-lg max-w-[80%]">
                    ${message}
                </div>
            `;
        chatContainer.appendChild(messageDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;
      }

      // Add loading indicator
      function addLoadingIndicator() {
        const loadingDiv = document.createElement("div");
        loadingDiv.id = "loading-indicator";
        loadingDiv.className = "flex justify-start mb-2";
        loadingDiv.innerHTML = `
                <div class="bg-gray-200 p-3 rounded-lg">
                    <div class="animate-pulse">Processing...</div>
                </div>
            `;
        chatContainer.appendChild(loadingDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;
        return loadingDiv;
      }

      // Remove loading indicator
      function removeLoadingIndicator() {
        const loadingDiv = document.getElementById("loading-indicator");
        if (loadingDiv) {
          loadingDiv.remove();
        }
      }

      // Send message to API
      async function sendMessageToAgent(message) {
        addUserMessage(message);
        chatInput.value = "";
        const loadingDiv = addLoadingIndicator();

        try {
          const response = await fetch("http://127.0.0.1:10000/prompt", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ prompt: message }),
          });
          const data = await response.json();
          const agentResponse = `"${data}"`;
          removeLoadingIndicator();
          addAgentMessage(agentResponse);
        } catch (error) {
          removeLoadingIndicator();
          addAgentMessage("Error: Could not get a response from the agent.");
          console.error("Error:", error);
        }
      }

      // Handle Send button click
      sendButton.addEventListener("click", () => {
        const message = chatInput.value.trim();
        if (message) {
          sendMessageToAgent(message);
        }
      });

      // Handle Enter key
      chatInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          const message = chatInput.value.trim();
          if (message) {
            sendMessageToAgent(message);
          }
        }
      });
    </script>
  </body>
</html>